<head>
  <title>Service Oriented Architecture</title>
  <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
  <script>

    // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

    var pusher = new Pusher('dd9f23cab2c8652cbd08', {
      cluster: 'us2'
    });

    var channel = pusher.subscribe('my-channel');
    channel.bind('my-event', function (data) {
      document.getElementById('async_response').innerHTML = JSON.stringify(data.message);
      document.getElementById('user_count').innerHTML = JSON.stringify(data.final_total);
    });
  </script>
</head>

<body>
  <h3>SOA Demo and Test example</h1>
    <h4>Status</h4>
    <ul>
      <li>There are currently: <span id="user_count"><%= @users.size %></span> users</li>
      <li>Last sync response at <%= JSON.parse(session[:result], symbolize_names: true)[:sync_time] %></li>
      <li>Last async response at <span id="async_response"></span></li>
    </ul>
    <h4>Synchronous Request to create some number of User records</h4>
    <form method="POST" action="/users/add/sync">
      <input type="submit" />
    </form>
    <h4>Asynchronous Request to create some number of User records</h4>
    <form method="POST" action="/users/add/async">
      <input type="submit" />
    </form>
</body>